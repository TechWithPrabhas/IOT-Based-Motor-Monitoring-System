PROGRAMMING CODE: 
#include<Arduino.h> 
#include<WiFi.h> 
#include<WiFiMulti.h> 
#include<HTTPClient.h> 
#defineUSE_SERIAL Serial 
WiFiMulti wifiMulti; 
 
#include<SoftwareSerial.h> 
#include<ModbusMaster.h> 
SoftwareSerial mySerial(26, 27); // RX, TX 
floattemp(void); 
/*! 
  We're using a MAX485-compatible RS485 Transceiver. 
  Rx/Tx is hooked up to the hardware serial port at 'Serial'. 
  The Data Enable and Receiver Enable pins are hooked up as follows: 
*/ 
uint16_tmbr [] = {0x15,0x0017,0x0019,0x001b,0x0096}; 
#defineMAX485_DE   13 
String mdata; 
float t = 0; 
float d = 0; 
String in; 
float datain = 0; 
// instantiate ModbusMaster object 
ModbusMaster node; 
 
voidpreTransmission() 
{ 
  digitalWrite (MAX485_DE, 1); 
} 
voidpostTransmission () 
{ 
  digitalWrite (MAX485_DE, 0); 
} 
// Include the libraries we need 
#include<OneWire.h> 
#include<DallasTemperature.h> 
 
// Data wire is plugged into port 2 on the Arduino 
#defineONE_WIRE_BUS4 
 
// Setup a oneWire instance to communicate with any OneWire devices 
(not just Maxim/Dallas temperature ICs) 
OneWire oneWire(ONE_WIRE_BUS); 
 
// Pass our oneWire reference to Dallas Temperature.  
DallasTemperature sensors(&oneWire);
/* 
 * The setup function. We only start the sensors here 
 */ 
int rotation = 0; 
float rpmx = 0; 
int numberOfDevices; // Number of temperature devices found 
DeviceAddress tempDeviceAddress; // We'll use this variable to store 
a found device address 
voidsetup (){ 
  Serial.begin(115200); 
  // Serial.setDebugOutput(true); 
  mySerial.Begin (9600); 
 
  pinMode (MAX485_DE, OUTPUT); 
  pinMode (2, INPUT); 
   
  digitalWrite (MAX485_DE, 0); 
 
  Serial.println(); 
  Serial.println(); 
  Serial.println(); 
 node. begin(1,mySerial); 
   node.preTransmission(preTransmission); 
  node.postTransmission (postTransmission); 
  for(uint8_t t = 4; t >0; t--){ 
    Serial.printf("[SETUP] WAIT %d...\n", t); 
    Serial.flush(); 
    delay (1000); 
     
  } 
 pinMode(5,INPUT_PULLUP); 
      sensors.begin(); 
       
 wifiMulti.addAP("iot1", "iot1234567890"); 
} 
voidloop (){ 
    mdata = meterdata (); 
    Serial.println(mdata); 
    Serial.print("Requesting temperatures..."); 
  sensors.requestTemperatures(); // Send the command to get 
temperatures 
  Serial.println("DONE"); 
  // After we got the temperatures, we can print them here. 
  // We use the function ByIndex, and as an example get the 
temperature from the first sensor only. 
    mdata += "val5="; 
    String t = tempdata(); 
    mdata += String(t); 
    Serial.println(mdata); 
 float r = rpm (); 
  Serial.print("RPM= "); 
  Serial.println(r); 
  Mdata+="&val6="; 
  Mdata += String(r); 
Serial.println(mdata); 
if ((wifiMulti.run () == WL_CONNECTED)){ 
 
        HTTPClient http; 
Serial.print("http"); 
Serial.println(mdata); 
        USE_SERIAL.print("[HTTP] begin...\n"); 
        // configure traged server and url 
        //http.begin("https://www.howsmyssl.com/a/check", ca); 
//HTTPS 
        http.begin(mdata); //HTTP 
 
        USE_SERIAL.print("[HTTP] GET...\n"); 
        // start connection and send HTTP header 
        int httpCode = http.GET (); 
 
        // httpCode will be negative on error 
        If (httpCode >0){ 
            // HTTP header has been send and Server response header 
has been handled 
            USE_SERIAL.printf("[HTTP] GET... code: %d\n", httpCode); 
 
            // file found at server 
            If (httpCode == HTTP_CODE_OK){ 
                String payload = http.getString(); 
                USE_SERIAL.println(payload); 
            } 
        }else{ 
            USE_SERIAL.printf ("[HTTP] GET... failed, error: %s\n", 
http. errorToString(httpCode).c_str ()); 
        } 
 
        http.end(); 
    } 
 Delay (5000); 
} 
String meterdata(void) 
{ 
   uint8_t result=0; 
  uint16_tI = 0x0000; 
// uint8_t d [2]; 
union 
{ 
  uint16_tu [2]; 
  float f;
} meterdata; 
String data= â€œhttps://motormonitoring.hexitronics.in/data.php?"; 
for (int k = 0; k<5; k++) 
{ 
  data.concat("val"); 
  data.concat(String(k)); 
  data.concat("="); 
  Serial.println(k); 
  Serial.println(data); 
  result =  node.readInputRegisters(mbr[k], 2); 
 if(result == node.ku8MBSuccess) 
  { 
    meterdata.u[0] = node.getResponseBuffer(0x01); 
    meterdata.u[1] = node.getResponseBuffer(0x00); 
     
    Serial.print("k"); 
    Serial.print("= "); 
    Serial.println(k); 
    Serial.println(meterdata.f); 
    data. concat (String (meterdata. f)); 
  } 
  Else 
  { 
    Serial.println ("failed"); 
    Data.Concat (String ("0.0")); 
  } 
  data. concat ("&"); 
  
  delay(100); 
} 
  return data; 
} 
 
floatrpm () { 
unsignedlong t = 0; 
int b=0; 
while(digitalRead(5) == 1) 
{ 
  Serial.println("idle"); 
   Serial.println(digital Read (5)); 
b++; 
if(b>5000) 
{ 
  return0; 
} 
} 
while (digital Read (5) == 0) 
{ 
  //Serial.println(digital Read (5)); 
  T++; 
Serial.println (t); 
  delay (1); 
  if (t >2000) 
  return0; 
} 
Serial.println(t); 
Rpmx = 60.00/ (t); 
Serial.println (rpmx); 
Rpmx = rpmx *1000.00; 
Serial.println (rpmx, 5); 
return rpmx; 
} 
String tempdata(void) 
{ 
String data = ""; 
float value=0.0; 
Serial.print(" Requesting temperatures..."); 
  sensors. request Temperatures (); // Send the command to get 
temperatures 
  Serial.println("DONE"); 
 
  //Serial.print (sensors.getTempCByIndex(0)); // Why "byIndex"?  
 Value = sensors.getTempCByIndex (0); 
Serial.println (value); 
while (value < -55) 
{ 
  sensors. request Temperatures (); // Send the command to get 
temperatures 
  Value = sensors.getTempCByIndex (0); 
} 
 data. concat(String(value)); 
Serial.println(data); 
  return data; 
} 
